<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Employee Verified | Codivora Technologies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="../assets/favicon.ico">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at top, #f6f7ff 0%, #ffffff 45%);
        }

        .card-box {
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(18px);
            border-radius: 26px;
            padding: 50px 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.08);
        }

        .verify-animation {
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .spinner {
            width: 56px;
            height: 56px;
            border: 6px solid #e5e7eb;
            border-top: 6px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .checkmark {
            display: none;
            width: 70px;
            height: 70px;
        }

        .checkmark svg {
            width: 70px;
            height: 70px;
        }

        .checkmark path {
            fill: none;
            stroke: #22c55e;
            stroke-width: 6;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: draw 0.6s ease forwards;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes draw {
            to { stroke-dashoffset: 0; }
        }

        .badge-ok {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 10px 18px;
            border-radius: 12px;
            font-weight: 700;
            display: inline-block;
        }

        .pdf-logo {
            height: 46px;
            width: auto;
        }

        .qr-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 40px;
            gap: 20px;
        }

        .qr-label {
            font-size: 0.9rem;
            color: #555;
        }

        @media print {
            body {
                background: white !important;
            }

            nav,
            .btn {
                display: none !important;
            }

            .card-box {
                box-shadow: none !important;
                border-radius: 0 !important;
                padding: 0 !important;
            }

            .pdf-logo {
                height: 42px;
            }

            .pdf-footer {
                margin-top: 40px;
                font-size: 0.9rem;
                color: #444;
            }
        }
    </style>
</head>

<body>

<nav class="navbar navbar-light bg-white py-3 shadow-sm">
    <div class="container px-5">
        <a class="navbar-brand" href="../index.html">
            <img src="../assets/Logo.png" height="40" alt="Codivora Technologies">
        </a>
    </div>
</nav>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card-box text-center">

                <div class="mb-4 text-start">
                    <img src="../assets/Logo.png" alt="Codivora Technologies" class="pdf-logo">
                </div>

                <div class="verify-animation">
                    <div class="spinner" id="spinner"></div>
                    <div class="checkmark" id="checkmark">
                        <svg viewBox="0 0 52 52">
                            <path d="M14 27 L22 35 L38 18"></path>
                        </svg>
                    </div>
                </div>

                <div id="verificationBadge" class="badge-ok mb-4">
                    Verification Successful
                </div>

                <h3 id="name" class="fw-bolder mb-3"></h3>

                <div class="text-start mt-4">
                    <p><strong>Age:</strong> <span id="age"></span></p>
                    <p><strong>Designation:</strong> <span id="designation"></span></p>
                    <p><strong>Education:</strong> <span id="education"></span></p>
                    <p><strong>Institute:</strong> <span id="institute"></span></p>
                    <p><strong>Email:</strong> <span id="email"></span></p>
                </div>

                <hr class="my-4">

                <div id="officialWording" class="text-start"></div>

                <!-- QR CODE SECTION -->
                <div class="qr-box">
                    <div class="qr-label">
                        <strong>Scan to verify this document</strong><br>
                        
                    </div>
                    <div id="qrCode"></div>
                </div>

                <div class="pdf-footer text-start mt-4">
                    <p>
                        This is a digitally generated verification document and does not require
                        any physical signature or seal.
                    </p>
                </div>

                <div class="mt-4 d-flex gap-3 justify-content-center">
                    <button class="btn btn-primary" onclick="downloadPDF()">
                        Download Verification PDF
                    </button>
                    <a href="/verify" class="btn btn-outline-secondary">
                        Verify Another Employee
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    const data = JSON.parse(localStorage.getItem("verifiedEmployee"));
    const spinner = document.getElementById("spinner");
    const checkmark = document.getElementById("checkmark");

    const params = new URLSearchParams(window.location.search);
    const purpose = params.get("purpose") || "general";

    const badge = document.getElementById("verificationBadge");
    const wording = document.getElementById("officialWording");

    const purposeContent = {
        education: {
            badge: "Educational Verification",
            text: `
                <p>
                    This document confirms that the above-mentioned individual is associated with
                    <strong>Codivora Technologies</strong> as per internal records.
                </p>
                <p>
                    Issued for academic or institutional reference only.
                </p>
            `
        },
        employment: {
            badge: "Employment Verification",
            text: `
                <p>
                    This verifies the association of the above-mentioned individual with
                    <strong>Codivora Technologies</strong> based on available records.
                </p>
            `
        },
        internship: {
            badge: "Internship Confirmation",
            text: `
                <p>
                    This confirms the internship association of the above-mentioned individual
                    with <strong>Codivora Technologies</strong>.
                </p>
            `
        },
        general: {
            badge: "Verification Successful",
            text: `
                <p>
                    This verification confirms the association of the above-mentioned individual
                    with <strong>Codivora Technologies</strong>.
                </p>
            `
        }
    };

    if (!data) {
        window.location.href = "/verify/not-found.html";
    } else {
        setTimeout(() => {
            spinner.style.display = "none";
            checkmark.style.display = "block";
        }, 900);

        document.getElementById("name").innerText = data.name;
        document.getElementById("age").innerText = data.age;
        document.getElementById("designation").innerText = data.designation;
        document.getElementById("education").innerText = data.education;
        document.getElementById("institute").innerText = data.institute;
        document.getElementById("email").innerText = data.email;

        const content = purposeContent[purpose] || purposeContent.general;
        badge.innerText = content.badge;
        wording.innerHTML = content.text;

        const verificationURL = window.location.href;

        new QRCode(document.getElementById("qrCode"), {
            text: verificationURL,
            width: 96,
            height: 96,
            correctLevel: QRCode.CorrectLevel.M
        });
    }

    function downloadPDF() {
        window.print();
    }
</script>

</body>
</html>
